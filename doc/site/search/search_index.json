{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"index.html","title":"Introduction","text":""},{"location":"index.html#introduction","title":"Introduction","text":"<p>OFTSWA is a high-level wrapper for the OFT flux transport model, designed for space weather applications.  </p> <p>It can run all three major components of OFT, automatically organizing the runs and post processing.  Options for the model are specified by a simple text file in a YAML format.</p> <p>This guide will show you how to install and run OFTSWA.</p>"},{"location":"install.html","title":"OFTSWA Installation Instructions","text":""},{"location":"install.html#linux-ubuntu-based-20042204-distributions","title":"Linux Ubuntu-based (20.04/22.04) distributions","text":""},{"location":"install.html#install-the-required-ubuntu-packages","title":"Install the required Ubuntu packages:","text":"<pre><code>sudo apt install bash make build-essential gfortran tar openmpi-bin libopenmpi-dev git libhdf5-dev libhdf5-openmpi-dev python3-pip hdf5-tools ffmpeg htop libblas-dev liblapack-dev qtbase5-dev xterm x11-apps\n</code></pre>"},{"location":"install.html#install-python-packages","title":"Install Python Packages:","text":"<pre><code>pip install numpy matplotlib h5py scipy zenodo_get pandas astropy sunpy\n</code></pre>"},{"location":"install.html#create-and-enter-an-oft-installation-folder","title":"Create and Enter an OFT installation folder:","text":"<pre><code>cd &lt;PATH-TO-INSTALL-TO&gt;\nmkdir oft\nmkdir oft/code\ncd oft/code\n</code></pre>"},{"location":"install.html#clone-the-git-repository","title":"Clone the git repository:","text":"<pre><code>git clone --recursive https://github.com/predsci/OFT.git .\n</code></pre>"},{"location":"install.html#install-oftswa","title":"Install OFTSWA:","text":"<p>The main OFTSWA script called <code>oftswa.py</code> provided with this package is not yet part  of the github repository. With the username and password given to you by PSI, you can download the script here: </p> <pre><code>https://predsci.com/downloads/ccmc_oftswa_sbir_phase1/oftswa.py\n</code></pre> <p>After downloading the script, copy it into the OFT bin folder:</p> <pre><code>cp oftswa.py &lt;PATH-TO-INSTALL-TO&gt;/oft/code/bin/  \n</code></pre>"},{"location":"install.html#enter-the-hipft-directory-and-build-hipft","title":"Enter the HipFT directory and build HipFT:","text":"<pre><code>cd hipft\n./build_examples/build_gcc_ubuntu20.04_cpu.sh\n</code></pre>"},{"location":"install.html#test-the-hipft-installation","title":"Test the HipFT installation:","text":"<pre><code>cd testsuite\n./run_test_suite.sh -mpicall='mpirun -bind-to socket -np' -hipftexe=${PWD}/../bin/hipft\n</code></pre>"},{"location":"install.html#return-to-the-oft-folder","title":"Return to the <code>oft</code> folder:","text":"<pre><code>cd ../../\n</code></pre>"},{"location":"install.html#enter-the-conflow-directory-and-build-conflow","title":"Enter the ConFlow directory and build ConFlow:","text":"<pre><code>cd conflow\n./build_examples/build_gcc_ubuntu20.04_cpu.sh\n</code></pre>"},{"location":"install.html#return-to-the-oft-folder_1","title":"Return to the <code>oft</code> folder:","text":"<pre><code>cd ../\n</code></pre>"},{"location":"install.html#enter-the-magmap-directory-and-install-the-magmap-python-package","title":"Enter the MagMAP directory and install the MagMAP python package:","text":"<pre><code>cd magmap\npip install -e ${PWD}\n</code></pre>"},{"location":"install.html#return-to-the-oft-folder_2","title":"Return to the <code>oft</code> folder:","text":"<pre><code>cd ../\n</code></pre>"},{"location":"install.html#source-the-startup-script-with-the-command","title":"Source the startup script with the command:","text":"<pre><code>. load_oft_env.sh\n</code></pre>"},{"location":"install.html#troubleshooting","title":"Troubleshooting","text":"<p>If there are any issues in the above installation, or if you are installing on a different platform and/or on GPUs, see the documentation in the hipft, conflow, and magmap submodules for more information/instructions.</p>"},{"location":"run.html","title":"OFTSWA Run Instructions","text":"<p>OFTSWA is a high-level wrapper for the OFT model, specifically designed for space weather applications.  It can run all three major components of OFT, taking care of file names, folder structure, post processing, and map processing (remapping, smoothing, etc.)  </p>"},{"location":"run.html#inputs","title":"Inputs","text":""},{"location":"run.html#input-yaml-file","title":"Input YAML file","text":"<p>OFTSWA uses a text file written in a format called YAML to run the model.  A default YAML file is included in the OFT repository in <code>rsrc/default.yaml</code>.  This default YAML file contains all available input parameters, and is loaded during an OFTSWA run.  The user's custom YAML file is then loaded, and any parameters that differ from the default are updated, and the final combined YAML file is used for the run and saved in the output run folder.  The user's YAML file therefore only need specify parameters that differ from the default, allowing for streamlined input files.</p> <p>For details on the format and available options in the input YAML file, see here.</p>"},{"location":"run.html#initial-full-sun-magnetic-map-optional","title":"Initial full-Sun magnetic map (optional)","text":"<p>When running flux transport with OFTSWA, a map file can be specified to be used as the initial full-Sun magnetic map in HipFT.  This map must match the grid and resolution of the requested HipFT run.  If no initial map is specified, a zero-value map will be used.</p>"},{"location":"run.html#outputs","title":"Outputs","text":"<p>The outputs of an OFTSWA run is dependent on which model components were run and with what options set in the YAML file.  These include observational magnetic disk images and maps, convective flow fields, full-Sun magnetic maps (the raw maps from the flux transport model, processed versions of those maps, and/or processed versions on the grid style used in the WSA solar wind model), post processing quantities including run history diagnostics, images and movies of the maps and butterfly diagrams.  </p>"},{"location":"run.html#folder-structure","title":"Folder Structure","text":"<p>OFTSWA uses a user specified main run directory to store and compute all OFTSWA runs. The location of the main run directory is set with the <code>-o</code> flag as shown below.  </p> <p>For any OFTSWA run, a run folder is created within the main run directory.  The name of this run folder is set to the run name specified in the input YAML file.</p> <p>For each component of OFTSWA being run or specified (MagMAP, ConFlow, and HipFT), a subfolder appears within the run folder.  For new MagMAP and/or ConFlow runs, <code>magmap</code> and/or <code>conflow</code> subfolders are created.  If previously run MagMAP and/or ConFlow runs are being used, soft links of the same name are created that point to the preexisting runs.  The HipFT component run is performed in a <code>hipft</code> subfolder.  </p> <p>When a run is executed, the merged input YAML file is placed in the run folder.  If post processing is activated, the post processing directories are also placed in the run folder.  All standard output and standard error outputs from the various codes and tools are piped into the <code>oftswa.log</code> and <code>oftswa.err</code> files respectively.</p> <p>An example folder structure with two runs, one that ran only ConFlow and MagMAP (<code>run1</code>), and one that ran HipFT using the original run (<code>run2</code>) is shown here:</p> <pre><code>oft_runs/\n\noft_runs/run1/\noft_runs/run1/conflow/\noft_runs/run1/magmap/\noft_runs/run1/magmap/magmap_data_disks/\noft_runs/run1/magmap/magmap_data_maps/\noft_runs/run1/run1.yaml\noft_runs/run1/oftswa.log\noft_runs/run1/oftswa.err\n\noft_runs/run2/\noft_runs/run2/conflow --&gt; ../run1/conflow\noft_runs/run2/magmap --&gt; ../run1/magmap\noft_runs/run2/hipft/\noft_runs/run2/hipft/input_map/\noft_runs/run2/hipft/output_maps/\noft_runs/run2/hipft/processed_maps/\noft_runs/run2/hipft/processed_maps_wsa/\noft_runs/run2/post_processing_raw/\noft_runs/run2/post_processing_processed/\noft_runs/run2/run2.yaml\noft_runs/run2/oftswa.log\noft_runs/run2/oftswa.err\n</code></pre>"},{"location":"run.html#loading-oft","title":"Loading OFT","text":"<p>To load OFT into your terminal environment, enter the OFT code directory, and source the included loading script:</p> <pre><code>cd {OFT_DIR}  \n. load_oft_env.sh\n</code></pre> <p>This assumes that all components of OFT have been properly installed (see the intallation guide) and that the <code>oftswa.py</code> has been copied into the <code>bin</code> folder.</p>"},{"location":"run.html#oftswa-run-command","title":"OFTSWA Run Command","text":"<p>Once the OFT code has been loaded, and the desired input YAML file is created, OFTSWA can then be run with the command:</p> <pre><code>oftswa.py -o &lt;PATH-TO-MAIN-RUN-FOLDER&gt; your_input_file.yaml\n</code></pre>"},{"location":"run_example.html","title":"OFTSWA Run Example","text":"<p>Since running MagMAP and ConFlow takes considerable time,  we have provided a pre-computed run of OFTSWA that ran a month/CR of ConFlow and MagMAP.  This run data can be used to launch OFTSWA to run HipFT using the data.  We have provided a YAML input file for OFTSWA for the run. </p> <p>The YAML file and run data are available in a zenodo package.</p>"},{"location":"run_example.html#install-oft-oftswa","title":"Install OFT &amp; OFTSWA","text":"<p>To run the example, first make sure OFT is properly installed including <code>oftswa.py</code> as described in the [installation instructions]."},{"location":"run_example.html#make-a-main-run-directory","title":"Make a Main Run Directory","text":"<pre><code>cd &lt;PATH-TO-OFT-INSTALLATION&gt;\nmkdir oft/runs\ncd oft/runs\n</code></pre>"},{"location":"run_example.html#download-the-example-run-data-from-zenodo","title":"Download the example run data from zenodo","text":"<p>Download the contents of the zenodo example package: https://zenodo.org/records/14799033 and untar it into the run folder:</p> <pre><code>tar -xf oftswa_example_run1_conflow_magmap.tar &lt;PATH-TO-OFT-INSTALLATION&gt;/oft/runs/\n</code></pre>"},{"location":"run_example.html#source-the-oft-startup-script-with-the-command","title":"Source the OFT startup script with the command","text":"<pre><code>. &lt;PATH-TO-OFT-INSTALLATION&gt;/oft/code/load_oft_env.sh\n</code></pre>"},{"location":"run_example.html#run-oftswa-with-the-yaml-input-file-included-in-the-zenodo-package","title":"Run OFTSWA with the YAML input file included in the Zenodo package","text":"<pre><code>oftswa.py oftswa_example_run2_hipft.yaml -o &lt;PATH-TO-OFT-INSTALLATION&gt;/oft/runs\n</code></pre> <p>After the HipFT run is complete, the maps will be processed and all post processing will be produced.  The last frame is shown here:</p> <p> </p>"},{"location":"yaml.html","title":"OFTSWA Input YAML File Details","text":"<p>OFTSWA uses a text file written in a format called YAML to run the model.  A default YAML file is included in the OFT repository in <code>rsrc/default.yaml</code>.  This default YAML file contains all available input parameters, and is loaded during an OFTSWA run.  The user's custom YAML file is then loaded, and any parameters that differ from the default are updated, and the final combined YAML file is used for the run and saved in the output run folder.  The user's YAML file therefore only need specify parameters that differ from the default, allowing for streamlined input files.</p> <p>The YAML file is organized into the several sections.  The following is a detailed description of each available parameter, shown as they appear in the default YAML file.  </p>"},{"location":"yaml.html#general-oftswa-run-information","title":"General OFTSWA run information:","text":"<pre><code>run:\n  run_name: 'run1'\n  preexisting_magmap_runname: ''\n  preexisting_conflow_runname: ''\n  date_start: '2022-01-01T00:00:00'\n  date_end:   '2022-01-28T00:00:00'\n  map_resolution:\n    np: 1024\n    nt: 512\n  mpi_run_command: 'mpirun -bind-to none -np &lt;NP&gt;'\n  mpi_num_procs: 1\n  omp_num_threads: ''\n</code></pre> <ul> <li> <p><code>run_name</code>: This is the user's chosen run name.  It is independent of the name of the input YAML file, and will be used as the name of the run directory within the main OFTSWA output run folder.  It is also used to name the final merged YAML file stored in the run folder.</p> </li> <li> <p><code>preexisting_magmap_runname</code>: If not requesting a new MagMAP database of assimilation data, this specifies the run name of a previously existing MagMAP run.  This preexisting database is used with the OFTSWA run and/or is updated based on the parameter choices.</p> </li> <li> <p><code>preexisting_conflow_runname</code>: If not requesting a new ConFlow database of flow data, this specifies the run name of a previously existing ConFlow run.  This preexisting database is used with the OFTSWA run.</p> </li> <li> <p><code>date_start</code>: The UTC date/time for the start of the run.  This is specified in the format 'YYYY-MM-DDTHH:MM:SS'.  This date represents the start date for the HipFT run, and is also used as the initial requested date/time when creating a new MagMAP database.</p> </li> <li> <p><code>date_end</code>: The UTC date/time for the end of the run.  This is specified in the format 'YYYY-MM-DDTHH:MM:SS'.  This date represents the end date for the HipFT run, and is also used as the final requested date/time when creating a new MagMAP database.</p> </li> <li> <p><code>map_resolution</code>: The <code>np</code> and <code>nt</code> parameters in this entry determine or declare the desired resolution for the OFTSWA run.  Here, <code>np</code> is the number of longitudinal (phi) points, while <code>nt</code> is the number of latitudinal points in colatitude (theta).  For OFTSWA runs that are creating new data sets of ConFlow and/or MagMAP, this resolution will be used.  For runs using preexisting ConFlow/MagMAP data sets, the specified resolution must match that used to create the preexisting data sets.  Also, if one is using an initial magnetic map file for the HipFT run, the resolution between that file and that specified here must match.</p> </li> <li> <p><code>mpi_run_command</code>: The command to use when launching MPI codes (currently, only HipFT uses MPI).  The special tag <code>&lt;NP&gt;</code> is replaced by the number of MPI processes when the code is launched.  </p> </li> <li> <p><code>mpi_num_procs</code>: The number of MPI processes to use.  When running on GPUs, this should be set to the number of GPUs per compute node being used.  </p> </li> <li> <p><code>omp_num_threads</code>:  The number of OpenMP threads to use for codes and tools that are multi-threaded on the CPU.  This includes HipFT when running on CPUs, in which case it specifies the number of CPU threads per MPI process.</p> </li> </ul> <p></p>"},{"location":"yaml.html#conflow-convective-flow-options","title":"ConFlow Convective Flow Options","text":"<pre><code>conflow:\n  run:  False\n  overwrite:  False\n</code></pre> <ul> <li><code>run</code>: Toggle to run ConFlow (<code>True</code>) or not (<code>False</code>). </li> <li><code>overwrite</code>: Toggle to overwrite a previous existing ConFlow run within the run folder.  If set to <code>True</code>, the previous ConFlow run is deleted before the new one is run.  If set to <code>False</code>, if a previous run exists in the run folder, ConFlow will not run. </li> </ul>"},{"location":"yaml.html#magmap-data-assimilation-data-options","title":"MagMAP Data Assimilation Data Options","text":"<pre><code>magmap:\n  run:  False\n  overwrite:  False\n  update:  False\n  map_cadence_hr: 1\n  map_source: 'hmi_los' \n</code></pre> <ul> <li><code>run</code>: Toggle to run MagMAP (<code>True</code>) or not (<code>False</code>). </li> <li><code>overwrite</code>: Toggle to overwrite a previous existing MagMAP run within the run folder.  If set to <code>True</code>, the previous MagMAP run is deleted before the new one is run.  If set to <code>False</code>, if a previous run exists in the run folder, MagMAP will not run, unless <code>update</code> is set to <code>True</code> (see below).  </li> <li><code>update</code>: If set to <code>True</code>, an update command will be applied to a preexisting MagMAP run.  This will fill in any missing data in the date range that may not have been available during the original launch of the preexisting MagMAP run.</li> <li><code>map_cadence_hr</code>: Set the map cadence for data acquisition and mapping in units of hours.</li> <li><code>map_source</code>: Set the observational source of the MagMAP data to acquire and map.  Currently, only <code>hmi_los</code> is available.</li> </ul>"},{"location":"yaml.html#hipft-flux-transport-options","title":"HipFT Flux Transport Options","text":"<pre><code>hipft:\n  run:  False\n  overwrite:  False\n  output_map_cadence_hr: 24\n  initial_map_filename: ''\n  initial_map_mult_fac: 1.0\n  data_assimilation_mult_fac: 1.0\n  random_flux_lifetime: 0.3\n  realization_combination_mode: 'sweep1d'\n  realization_parameters:\n    diffusion_coefs: [300.0]\n    flow_attenuation_values: [500.0]\n    data_assimilation_mu_limits: [0.1]\n    data_assimilation_mu_powers: [4.0]\n    data_assimilation_lat_limits: [0.0]\n    random_flux_amounts: [150.0]\n    flow_meridional_p1: [22.0]\n    flow_meridional_p3: [11.0]\n    flow_meridional_p5: [-28.0]\n    flow_differential_p0: [46.0]\n    flow_differential_p2: [-262.0]\n    flow_differential_p4: [-379.0]\n</code></pre> <ul> <li><code>run</code>: Toggle to run HipFT (<code>True</code>) or not (<code>False</code>)</li> <li><code>overwrite</code>: Toggle to overwrite a previous existing HipFT run within the run folder.  If set to <code>True</code>, the previous HipFT run is deleted before the new one is run.  If set to <code>False</code>, if a previous run exists in the run folder, HipFT will not run. </li> <li><code>output_map_cadence_hr</code>: Set the output map cadence for HipFT in units of hours. This can differ from the cadence of the MagMAP and ConFlow runs.</li> <li><code>initial_map_filename</code>: Set the full path to the chosen input full-Sun magnetic map.  The file must have the HipFT grid format and the same resolution as the current HipFT run.  If no map is specified, the run will start with a zero-value map.</li> <li><code>initial_map_mult_fac</code>:  Factor to multiply the initial map in HipFT.  </li> <li><code>data_assimilation_mult_fac</code>: Factor to multiply the MagMAP assimilated data before ingestion into HipFT.</li> <li><code>random_flux_lifetime</code>: Time span (in hours) between successive random flux generation.</li> </ul>"},{"location":"yaml.html#realization-parameter-specification","title":"Realization Parameter Specification:","text":"<p>A key feature of OFTSWA is specifying a range of realization parameters to run. Three modes of specifying the parameters are implemented:  1) <code>sweep1d</code>: For each list of parameters, span the range given while keeping all other parameters at default values.  For example, if one sets <code>par1=[a,b,c]</code> and <code>par2=[d,e,f]</code>, and assuming the default.yaml defines <code>par1=[a]</code> and <code>par2=[d]</code>, there would be 5 realizations: <code>(a,d),(b,d),(c,d),(a,e),(a,f)</code>.  The defaults can be changed by using a double list syntax, for example, <code>par1=[[g][a,b,c,g]]</code>.  This would set the default to <code>g</code> for all other parameters' 1D sweeps.  </p> <p>2) <code>crossall</code>:  All possible combinations of the lists of parameters are combined and used.  Any parameter not specified uses the default for all realizations, and any parameter that is set to a single value, resets the default.  For example, if one sets <code>par1=[a,b,c]</code>, <code>par2=[d,e,f]</code>, and <code>par3=[g]</code>, there will be 9 realizations: <code>(a,d,g),(a,e,g),(a,f,g),(b,d,g),(b,e,g),(b,f,g),(c,d,g),(c,e,g),(c,f,g)</code>.  </p> <p>3) <code>manual</code>: This mode requires the user to manually specify the full list for each parameter one wants to vary.  Any parameter not specified uses the default for all realizations, and any parameter that is set to a single value, resets the default.  For example, to specify the realizations shown in the <code>sweep1d</code> example above, one would need to set: <code>par1=[a,b,c,a,a]</code> and <code>par2=[d,d,d,e,f]</code>.</p> <ul> <li><code>realization_combination_mode</code>: Set the combination mode described above.  Options are <code>sweep1d</code>, <code>crossall</code>, or <code>manual</code>.</li> <li><code>realization_parameters</code>: For each of the following, they can be specified as single lists (<code>[a,b,c]</code>) or double lists (<code>[[g][a,b,c]]</code>).  See above for the description of what each means.  For more details on what each parameter does in the model, see OFT Paper I.<ul> <li><code>diffusion_coefs</code>: Diffusion coefficient in units of km^2/s.</li> <li><code>flow_attenuation_values</code>:  Field strength in Gauss to saturate the flow velocities.</li> <li><code>data_assimilation_mu_limits</code>: Data cutoff in mu=cos(theta) for assimilated data.</li> <li><code>data_assimilation_mu_powers</code>: Power for scaling weights for assimilated data.</li> <li><code>data_assimilation_lat_limits</code>: Data cutoff in degrees latitude for assimilated data.</li> <li><code>random_flux_amounts</code>: Amplitude of random flux emergence in units of 10^21 Mx/hr.</li> <li><code>flow_meridional_p1</code>: Factor for cos(theta) term in the analytic meridional flow profile in m/s.</li> <li><code>flow_meridional_p3</code>: Factor for cos^3(theta) term in the analytic meridional flow profile in m/s.</li> <li><code>flow_meridional_p5</code>: Factor for cos^5(theta) term in the analytic meridional flow profile in m/s.</li> <li><code>flow_differential_p0</code>: Factor for scalar term in the analytic differential rotation flow profile in m/s.</li> <li><code>flow_differential_p2</code>: Factor for cos^2(theta) term in the analytic differential rotation flow profile in m/s.</li> <li><code>flow_differential_p4</code>: Factor for cos^4(theta) term in the analytic differential rotation flow profile in m/s.</li> </ul> </li> </ul>"},{"location":"yaml.html#map-processing-options","title":"Map Processing Options","text":"<pre><code>output_map_processing:\n  run: False\n  overwrite: False\n  map_resolution_delta_deg: 1.0\n  smoothing_factor: 1.0\n  map_multiplier: 1.0\n  make_wsa_dataset: False\n</code></pre> <ul> <li><code>run</code>: Toggle to run map processing of the HipFT output (<code>True</code>) or not (<code>False</code>)</li> <li><code>overwrite</code>:  Toggle to overwrite a previous existing map processing.  If set to <code>True</code>, the previous map processing results are deleted before new ones are computed.  If set to <code>False</code>, if previous map processing results exist in the run folder, no map processing will be computed.</li> <li><code>map_resolution_delta_deg</code>:  Re-bin the maps to the chosen resolution using a flux-preserving method.  The resolution is specified by the delta-angle in degrees (e.g. setting to 1.0 will produce 361x181 maps).</li> <li><code>smoothing_factor</code>: If set, maps will be smoothed after any re-binning using the  surface diffusion advance in HipFT.  This factor determines the level of smoothing.</li> <li><code>map_multiplier</code>: If set, maps will be multiplied by this scalar.</li> <li><code>make_wsa_dataset</code>:  Toggle (<code>True</code>/<code>False</code>) to produce an additional set of maps with the same resolution as the processed maps, but on the grid format used in the WSA model (e.g. a 361x181 processed map becomes a 360x180 WSA input map).</li> </ul>"},{"location":"yaml.html#post-processing-options","title":"Post Processing Options","text":"<pre><code>hipft_post_process:\n  run:  True\n  overwrite:  False\n  history_plot_samples: 500\n  history_plot_samples_markers: 20\n</code></pre> <ul> <li><code>run</code>: Toggle to run post processing of the HipFT output and processed maps (<code>True</code>) or not (<code>False</code>)</li> <li><code>overwrite</code>: Toggle to overwrite a previous existing post processing within the run folder.  If set to <code>True</code>, the previous post processing results are deleted before new ones are computed.  If set to <code>False</code>, if previous post processing results exist in the run folder, no post processing will be computed.</li> <li><code>history_plot_samples</code>: Set the number of data points to use for the lines in the HipFT history plots.</li> <li><code>history_plot_samples_markers</code>: Set the number of data points to use for the markers in the HipFT history plots.</li> </ul>"}]}